Helsingborg=Helsingborg||{},Helsingborg.Search=Helsingborg.Search||{},Helsingborg.Search.Search=function(e){function t(){e(function(){this.handleEvents()}.bind(this))}var n,a,s,i,r,o,c,u=".search-result";return t.prototype.request=function(t){e.post(ajaxurl,t,function(t){t=e.parseJSON(t),this.handleResponse(t)}.bind(this))},t.prototype.handleResponse=function(t){e(u).empty(),n=void 0!==t.queries.nextPage?t.queries.nextPage[0]:void 0,s=void 0!==t.queries.previousPage?t.queries.previousPage[0]:void 0,r=void 0!==t.queries.request?t.queries.request[0]:void 0,c=r.count,o=r.totalResults,this.searchInfo(t),this.outputResults(t),this.setupPagination()},t.prototype.setupPagination=function(){void 0!==s?(i={action:"search",keyword:query,index:s.startIndex.toString()},e('[data-action="prev-page"]').show()):e('[data-action="prev-page"]').hide(),void 0!==n?(a={action:"search",keyword:query,index:n.startIndex.toString()},e('[data-action="next-page"]').show()):e('[data-action="next-page"]').hide()},t.prototype.searchInfo=function(t){var n='<span class="search-hits">'+t.searchInformation.formattedTotalResults+'</span> träffar på <span class="search-query">'+t.queries.request[0].searchTerms+"</span> inom Helsingborg.se";e(".search-hits-info").html(n)},t.prototype.outputResults=function(t){e.each(t.items,function(t,n){var a=(n.pagemap.metatags[0],e('<li class="search-result-item"><div class="search-result-item-content"></div></li>')),s=this.getDateModified(n);a.find(".search-result-item-content").append('<span class="search-result-item-date">'+s+"</span>"),a.find(".search-result-item-content").append("PDF/Adobe Acrobat"==n.fileFormat?'<h3><a href="'+n.link+'" class="pdf-item">'+n.htmlTitle+"</a></h3>":'<h3><a href="'+n.link+'" class="link-item">'+n.htmlTitle+"</a></h3>"),a.find(".search-result-item-content").append("<p>"+e.trim(n.htmlSnippet)+"</p>"),a.find(".search-result-item-content").append('<div class="search-result-item-info"></div>'),a.find(".search-result-item-info").append('<span class="search-result-item-url"><i class="fa fa-globe"></i> <a href="'+n.link+'">'+n.htmlFormattedUrl+"</a></span>"),e(u).append(a)}.bind(this))},t.prototype.getDateModified=function(e){var t=e.pagemap.metatags[0],n=null;return void 0!==t.moddate?n=this.convertDate(t.moddate):void 0!==t.pubdate?n=this.convertDate(t.pubdate):void 0!==t["last-modified"]&&(n=t["last-modified"]),n},t.prototype.convertDate=function(e){if(e.length>20){var t=e.substring(2,6),n=e.substring(6,8),a=e.substring(8,10);return n=this.convertDateToMonth(n),a+" "+n+" "+t}if(11==e.length)return e=e.replace("May","Maj"),e=e.replace("Oct","Okt");if(8==e.length){var t=e.substring(0,4),n=e.substring(4,6),a=e.substring(6,e.length);return n=this.convertDateToMonth(n),a+" "+n+" "+t}return""},t.prototype.convertDateToMonth=function(e){switch(e){case"01":return"Jan";case"02":return"Feb";case"03":return"Mar";case"04":return"Apr";case"05":return"Maj";case"06":return"Jun";case"07":return"Jul";case"08":return"Aug";case"09":return"Sep";case"10":return"Okt";case"11":return"Nov";case"12":return"Dec"}},t.prototype.handleEvents=function(){e(document).ready(function(){this.request({action:"search",keyword:query,index:"1"})}.bind(this)),e('[data-action="next-page"]').on("click",function(){e(u).html('<li class="event-times-loading"><i class="hbg-loading">Läser in resultat…</i></li>'),e("html, body").animate({scrollTop:0},"fast"),this.request(a)}.bind(this)),e('[data-action="prev-page"]').on("click",function(){e(u).html('<li class="event-times-loading"><i class="hbg-loading">Läser in resultat…</i></li>'),e("html, body").animate({scrollTop:0},"fast"),this.request(i)}.bind(this))},new t}(jQuery);