Helsingborg=Helsingborg||{},Helsingborg.Search=Helsingborg.Search||{},Helsingborg.Search.Search=function(e){function t(){e(function(){this.handleEvents()}.bind(this))}var i,n,a,s,r,o,l,c=".search-result",u=".pagination",d=!1,h=1;return t.prototype.request=function(t){e.post(ajaxurl,t,function(t){t=e.parseJSON(t),this.handleResponse(t)}.bind(this))},t.prototype.handleResponse=function(t){e(c).empty(),i=void 0!==t.queries.nextPage?t.queries.nextPage[0]:void 0,a=void 0!==t.queries.previousPage?t.queries.previousPage[0]:void 0,r=void 0!==t.queries.request?t.queries.request[0]:void 0,l=r.count,o=r.totalResults,this.searchInfo(t),this.outputResults(t),this.setupPagination()},t.prototype.setupPagination=function(){if(void 0!==a&&(s={action:"search",keyword:query,index:a.startIndex.toString()},e('[data-action="prev-page"]').show()),void 0!==i&&(n={action:"search",keyword:query,index:i.startIndex.toString()},e('[data-action="next-page"]').show()),o>l&&d!==!0){for(var t=o/l,r=1;t>=r;r++)e(".pagination li:last-child").before(r==h?'<li class="current"><a href="#" data-paginate-index="'+r+'">'+r+"</a></li>":'<li><a href="#" data-paginate-index="'+r+'">'+r+"</a></li>");d=!0,this.setPaginationCurrent()}e(".pagination").show()},t.prototype.searchInfo=function(t){var i='<span class="search-hits">'+t.searchInformation.formattedTotalResults+'</span> träffar på <span class="search-query">'+t.queries.request[0].searchTerms+"</span> inom Helsingborg.se";e(".search-hits-info").html(i)},t.prototype.outputResults=function(t){e.each(t.items,function(t,i){var n=(i.pagemap.metatags[0],e('<li class="search-result-item"><div class="search-result-item-content"></div></li>')),a=this.getDateModified(i);n.find(".search-result-item-content").append('<span class="search-result-item-date">'+a+"</span>"),n.find(".search-result-item-content").append("PDF/Adobe Acrobat"==i.fileFormat?'<h3><a href="'+i.link+'" class="pdf-item">'+i.htmlTitle+"</a></h3>":'<h3><a href="'+i.link+'" class="link-item">'+i.htmlTitle+"</a></h3>"),n.find(".search-result-item-content").append("<p>"+e.trim(i.htmlSnippet)+"</p>"),n.find(".search-result-item-content").append('<div class="search-result-item-info"></div>'),n.find(".search-result-item-info").append('<span class="search-result-item-url"><i class="fa fa-globe"></i> <a href="'+i.link+'">'+i.htmlFormattedUrl+"</a></span>"),e(c).append(n)}.bind(this))},t.prototype.getDateModified=function(e){var t=e.pagemap.metatags[0],i=null;return void 0!==t.moddate?i=this.convertDate(t.moddate):void 0!==t.pubdate?i=this.convertDate(t.pubdate):void 0!==t["last-modified"]&&(i=t["last-modified"]),i},t.prototype.convertDate=function(e){if(e.length>20){var t=e.substring(2,6),i=e.substring(6,8),n=e.substring(8,10);return i=this.convertDateToMonth(i),n+" "+i+" "+t}if(11==e.length)return e=e.replace("May","Maj"),e=e.replace("Oct","Okt");if(8==e.length){var t=e.substring(0,4),i=e.substring(4,6),n=e.substring(6,e.length);return i=this.convertDateToMonth(i),n+" "+i+" "+t}return""},t.prototype.convertDateToMonth=function(e){switch(e){case"01":return"Jan";case"02":return"Feb";case"03":return"Mar";case"04":return"Apr";case"05":return"Maj";case"06":return"Jun";case"07":return"Jul";case"08":return"Aug";case"09":return"Sep";case"10":return"Okt";case"11":return"Nov";case"12":return"Dec"}},t.prototype.browse=function(e){if("next"==e)h++,this.request(n);else if("prev"==e)h--,this.request(s);else{h=e;var t=10*h+1,i={action:"search",keyword:query,index:t};this.request(i)}this.setPaginationCurrent()},t.prototype.setPaginationCurrent=function(){e(u).find("li.current").removeClass("current"),e(u).find("li").filter(function(){return e(this).text()==h}).addClass("current"),h>3?(e(u).find("li").show(),e(u).find("li:gt("+(h+2)+")").hide(),e(u).find("li:lt("+(h-2)+")").hide(),e(u).find("li:first-child").show(),e(u).find("li:last-child").show()):(e(u).find("li:gt(5)").hide(),e(u).find("li:last-child").show())},t.prototype.handleEvents=function(){e(document).ready(function(){this.request({action:"search",keyword:query,index:"1"})}.bind(this)),e('[data-action="next-page"]').on("click",function(t){t.preventDefault(),e(c).html('<li class="event-times-loading"><i class="hbg-loading">Läser in resultat…</i></li>'),e("html, body").animate({scrollTop:0},"fast"),this.browse("next")}.bind(this)),e('[data-action="prev-page"]').on("click",function(t){t.preventDefault(),e(c).html('<li class="event-times-loading"><i class="hbg-loading">Läser in resultat…</i></li>'),e("html, body").animate({scrollTop:0},"fast"),this.browse("prev")}.bind(this)),e(document).on("click","[data-paginate-index]",function(t){t.preventDefault(),e(c).html('<li class="event-times-loading"><i class="hbg-loading">Läser in resultat…</i></li>'),e("html, body").animate({scrollTop:0},"fast"),this.browse(e(t.target).data("paginate-index"))}.bind(this))},new t}(jQuery);